function LogstatsDataConverter(t,e,a){this.data=t,this.interval=e,this.timeframe=a}function LogstatsGraphDrawer(t,e){this.selector=t,this.currentShowedData=[],e="undefined"!=typeof e?e:[],this.options=this.mergeDefaultOptions(e),this.flotLineOptions=this.getFlotLineOptions(),this.options.enablePointHover&&this.enableFlotHover(),this.options.enableSelectionZooming&&this.enableSelectionZooming()}LogstatsDataConverter.prototype.getMoreLinesAssociativeWithZeros=function(){var t=this.getEmptyGroupAssociativeData(),e=this.getGroupAssoc(t);return e},LogstatsDataConverter.prototype.getOneLineAssociativeWithZeros=function(){var t=this.getEmptyDateAssociativeData();return this.getAssoc(t)},LogstatsDataConverter.prototype.getAllGroupByNames=function(){var t=[];for(i=0;i<this.data.length;i++)-1==t.indexOf(this.data[i].group)&&t.push(this.data[i].group);return t},LogstatsDataConverter.prototype.getEmptyGroupAssociativeData=function(){for(var t=this.getAllGroupByNames(),e={},a=0;a<t.length;a++){var o=this.getEmptyDateAssociativeData();e[t[a]]=o}return e},LogstatsDataConverter.prototype.getEmptyDateAssociativeData=function(){for(var t=this.getStartDate(),e=this.getEndDate(),a=t,o={};a.isBefore(e);)this.initializeDateDate(o,a),o[a.year()][a.month()][a.date()][a.hour()][a.minute()]=0,this.incrementDate(a);return o},LogstatsDataConverter.prototype.getStartDate=function(){var t;if("undefined"!=typeof this.timeframe)t=this.roundDateDown(moment(this.timeframe.from,"X").tz("GMT"));else{var e=this.data[0];t=moment.tz({year:e.year,month:e.month-1,day:e.day,hour:e.hour,minute:e.minute},"GMT")}return t},LogstatsDataConverter.prototype.roundDateDown=function(t){return t.second(0),"minutely"==this.interval?t:(t.minute(0),"hourly"==this.interval?t:(t.hours(0),"daily"==this.interval?t:(t.date(1),"monthly"==this.interval?t:(t.month(0),t))))},LogstatsDataConverter.prototype.getEndDate=function(){var t;if("undefined"!=typeof this.timeframe)t=moment(this.timeframe.to,"X").tz("GMT");else{var e=this.data[this.data.length-1];t=moment.tz({year:e.year,month:e.month-1,day:e.day,hour:e.hour,minute:e.minute},"GMT")}return t},LogstatsDataConverter.prototype.incrementDate=function(t){return"minutely"==this.interval&&t.add(1,"m"),"hourly"==this.interval&&t.add(1,"h"),"daily"==this.interval&&t.add(1,"d"),"monthly"==this.interval&&t.add(1,"M"),"yearly"==this.interval&&t.add(1,"y"),t},LogstatsDataConverter.prototype.initializeDateDate=function(t,e){"undefined"==typeof t[e.year()]&&(t[e.year()]={}),"undefined"==typeof t[e.year()][e.month()]&&(t[e.year()][e.month()]={}),"undefined"==typeof t[e.year()][e.month()][e.date()]&&(t[e.year()][e.month()][e.date()]={}),"undefined"==typeof t[e.year()][e.month()][e.date()][e.hour()]&&(t[e.year()][e.month()][e.date()][e.hour()]={}),"undefined"==typeof t[e.year()][e.month()][e.date()][e.hour()][e.minute()]&&(t[e.year()][e.month()][e.date()][e.hour()][e.minute()]={})},LogstatsDataConverter.prototype.getGroupAssoc=function(t){for(var e=0;e<this.data.length;e++){var a=this.data[e],o=a.group,r=a.year,i="undefined"!=typeof a.month?a.month:1,n="undefined"!=typeof a.day?a.day:1,s="undefined"!=typeof a.hour?a.hour:0,h="undefined"!=typeof a.minute?a.minute:0;t[o][r][i-1][n][s][h]=a.value}return t},LogstatsDataConverter.prototype.getAssoc=function(t){for(var e=0;e<this.data.length;e++){var a=this.data[e],o=a.year,r="undefined"!=typeof a.month?a.month:1,i="undefined"!=typeof a.day?a.day:1,n="undefined"!=typeof a.hour?a.hour:0,s="undefined"!=typeof a.minute?a.minute:0;t[o][r-1][i][n][s]=a.value}return t},LogstatsGraphDrawer.prototype.mergeDefaultOptions=function(t){var e={timezone:null,chartColor:null};return $.each(e,function(e,a){"undefined"==typeof t[e]&&(t[e]=a)}),t},LogstatsGraphDrawer.prototype.draw=function(t,e){if(this.logstatsData=t,this.timeframe=e,this.interval=this.determineInterval(),this.groupBySet=this.determineGroupBy(),this.graphType=this.determineBestGraphType(),this.clearGraph(),!this.validDataCount())return void this.displayErrors(["Too much datapoints to display. Please choose larger interval or smaller timeframe"]);switch(this.graphType){case GraphType.NO_DATA:this.drawNoData();break;case GraphType.ONE_VALUE:this.drawOneValue();break;case GraphType.BAR:this.drawBar();break;case GraphType.ONE_LINE:this.drawOneLine();break;case GraphType.MULITPLE_LINES:this.drawMultipleLines()}},LogstatsGraphDrawer.prototype.clearGraph=function(){$(this.options.checkboxHolderSelector).html(""),$(this.selector).removeClass("graph-one-value-container")},LogstatsGraphDrawer.prototype.drawNoData=function(){this.displayErrors(["No data found by given query"])},LogstatsGraphDrawer.prototype.displayErrors=function(t){self=this,$(this.selector).html("<div class='bg-danger errors message-div'><ul class='list-unstyled'></ul></div>"),$.each(t,function(t,e){$("ul",$(self.selector)).append("<li>"+e+"</li>")})},LogstatsGraphDrawer.prototype.drawOneValue=function(){var t=this.logstatsData[0].value;$(this.selector).html("<div class='graph-one-value'>Result: "+t+"</div>"),$(this.selector).addClass("graph-one-value-container")},LogstatsGraphDrawer.prototype.drawBar=function(){var t=this.getFlotBarData();this.flot=$.plot(this.selector,t,this.getFlotBarOptions())},LogstatsGraphDrawer.prototype.drawOneLine=function(){var t=this.getFlotOneLineData();this.currentShowedData=t,this.flot=$.plot(this.selector,t,this.flotLineOptions)},LogstatsGraphDrawer.prototype.drawMultipleLines=function(){var t=this.getMultipleLineAssociativeDataWithZeros(),e=this.getFlotMultiLineData(t);this.currentShowedData=e,this.options.enableLineManipulation&&(this.showCheckboxes(),this.enableLineManipulation()),this.flot=$.plot(this.selector,e,this.flotLineOptions)},LogstatsGraphDrawer.prototype.getFlotMultiLineData=function(t){var e=this,a=[],o=0;return $.each(t,function(t,r){a.push({label:t,data:e.getFlotDateData(r),clickable:!0,hoverable:!0,shadowSize:2,color:o++})}),a},LogstatsGraphDrawer.prototype.getFlotDateData=function(t){var e=[];return $.each(t,function(t,a){$.each(a,function(a,o){$.each(o,function(o,r){$.each(r,function(r,i){$.each(i,function(i,n){var s=1e3*moment.tz({year:t,month:a,day:o,hour:r,minute:i},"GMT").unix();e.push([s,n])})})})})}),e},LogstatsGraphDrawer.prototype.getMultipleLineAssociativeDataWithZeros=function(){var t=new LogstatsDataConverter(this.logstatsData,this.interval,this.timeframe);return t.getMoreLinesAssociativeWithZeros()},LogstatsGraphDrawer.prototype.getFlotOneLineData=function(){var t=new LogstatsDataConverter(this.logstatsData,this.interval,this.timeframe),e=t.getOneLineAssociativeWithZeros();return[{data:this.getFlotDateData(e),label:"Result",clickable:!0,hoverable:!0,shadowSize:2,color:this.options.chartColor}]},LogstatsGraphDrawer.prototype.getFlotBarData=function(){var t=[];return $.each(this.logstatsData,function(e,a){t.push([e,a.value])}),[{label:"Result",data:t,clickable:!0,hoverable:!0,color:this.options.chartColor}]},LogstatsGraphDrawer.prototype.determineBestGraphType=function(){return 0==this.logstatsData.length?GraphType.NO_DATA:"undefined"!=typeof this.interval||this.groupBySet?"undefined"!=typeof this.interval&&this.groupBySet?GraphType.MULITPLE_LINES:"undefined"==typeof this.interval?GraphType.BAR:GraphType.ONE_LINE:GraphType.ONE_VALUE},LogstatsGraphDrawer.prototype.determineInterval=function(){if(0!=this.logstatsData.length){var t=this.logstatsData[0];return"undefined"!=typeof t.minute?"minutely":"undefined"!=typeof t.hour?"hourly":"undefined"!=typeof t.day?"daily":"undefined"!=typeof t.month?"monthly":"undefined"!=typeof t.year?"yearly":void 0}},LogstatsGraphDrawer.prototype.determineGroupBy=function(){if(0!=this.logstatsData.length){var t=this.logstatsData[0];return"undefined"!=typeof t.group}},LogstatsGraphDrawer.prototype.enableFlotHover=function(){var t=this;$(this.selector).bind("plothover",function(e,a,o){if(o){o.datapoint[0]>1e3?upper=t.getDateInFormat(moment(o.datapoint[0].toFixed(2),"x"))+"<br>":upper="";var r=o.datapoint[1].toFixed(2),i=o.series.label;$(t.options.tooltipSelector).html(upper+i+" : "+r).css({top:o.pageY+5,left:o.pageX+5}).show()}else $(t.options.tooltipSelector).hide()})},LogstatsGraphDrawer.prototype.getDateInFormat=function(t){return"yearly"==this.interval?this.formatedTime(t,"YYYY"):"monthly"==this.interval?this.formatedTime(t,"MMMM YYYY"):"daily"==this.interval?this.formatedTime(t,"MMMM Do YYYY"):"hourly"==this.interval?this.formatedTime(t,"MMMM Do YYYY, H:mm"):this.formatedTime(t,"MMMM Do YYYY, H:mm")},LogstatsGraphDrawer.prototype.formatedTime=function(t,e){return null==this.options.timezone?t.tz("GMT").format(e):t.tz(this.options.timezone).format(e)},LogstatsGraphDrawer.prototype.enableLineManipulation=function(){var t=this;$(t.options.checkboxHolderSelector+" input").click(function(){var e=[];$(t.options.checkboxHolderSelector+" input:checked").each(function(){var a=$(this).attr("name");a!==!1&&t.currentShowedData[a]&&e.push(t.currentShowedData[a])}),e.length>0&&(t.flot.setData(e),t.flot.draw())})},LogstatsGraphDrawer.prototype.showCheckboxes=function(){$(this.options.checkboxHolderSelector).html("");var t=this;$.each(this.currentShowedData,function(e,a){$(t.options.checkboxHolderSelector).append("<input type='checkbox' name='"+e+"' checked='checked' id='id"+e+"'></input><label for='id"+e+"'>"+a.label+"</label>")})},LogstatsGraphDrawer.prototype.enableSelectionZooming=function(){var t=this;$(this.selector).bind("plotselected",function(e,a){$.each(t.flot.getXAxes(),function(t,e){var o=e.options;o.min=a.xaxis.from,o.max=a.xaxis.to}),t.flot.setupGrid(),t.flot.draw(),t.flot.clearSelection()})},LogstatsGraphDrawer.prototype.getFlotLineOptions=function(){var t={series:{lines:{show:!0},points:{show:!0}},grid:{clickable:!0,hoverable:!0,autoHighlight:!0},xaxis:{mode:"time",timezone:this.options.timezone}};return this.options.enableSelectionZooming&&(t.selection={mode:"x"}),t},LogstatsGraphDrawer.prototype.getFlotBarOptions=function(){var t=[];return $.each(this.logstatsData,function(e,a){t.push([e,a.group])}),{series:{lines:{show:!1},bars:{show:!0},points:{show:!1}},bars:{align:"center",barWidth:.5},grid:{clickable:!0,hoverable:!0,autoHighlight:!0},xaxis:{ticks:t}}},LogstatsGraphDrawer.prototype.validDataCount=function(){if(!this.timeframe||!this.interval)return!0;var t=(this.timeframe.to-this.timeframe.from)/60,e=this.getStepFromInterval(this.interval);const a=5e4;return a>t/e},LogstatsGraphDrawer.prototype.getStepFromInterval=function(t){var e=1;return"minutely"==t?e:(e*=60,"hourly"==t?e:(e*=24,"daily"==t?e:(e*=30,"monthly"==t?e:e*=12)))},LogstatsGraphDrawer.prototype.isExportable=function(){return this.graphType!=GraphType.NO_DATA};var GraphType={NO_DATA:"no data",BAR:"bar",ONE_VALUE:"one value",ONE_LINE:"one line",MULITPLE_LINES:"mulitple lines"};